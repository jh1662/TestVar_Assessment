<%- include('../../assets/header.html') %>
<title>Login</title>
<script>
  commons.test();


  console.log("start script");
  async function submitForm(event){
    console.log("start function");
    //: set-up
    let response; let data; 
    event.preventDefault();
    //^ prevent the default form submission
    const input = document.getElementById('form');
    //^ get user's input
    data = {
      //* user's inputs
      username: input.username.value,
      password: input.password.value
    };
    console.log(data);
    response = await fetch(
      //* user's request
      '/user/login',{
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      }
    ); 
    response = await response.json();

    console.log("response: VVV");
    console.log(response);

    if(response.status == 422){ 
      data = { info:{title: "error", subTitle: response.status, message: response.body.message}};
      response = await fetch(
        '/message',{
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
      document.body.innerHTML = await response.text();
      return; 
    }
    if (response.status == 201){
      console.log("body is: VVV");
      console.log(response.body);
      console.log("ID is: VVV");
      console.log(response.body.id);
      commons.storeId(response.id);
      //window.location.replace("/home");
      return; 
    }
    console.log("end function");
  };
  // <form action="/user/login" method="POST" >
  console.log("end script");
</script>
</header>
<body>
  <%- include('../../assets/nav.html') %>
  <main>
  <h1>Login</h1>
  <div class="loginContainer">
    <h2>Enter credentials:</h2>
    <form id="form" onsubmit="submitForm(event)">
      <div class="inputGroup">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required>
      </div>
      <div class="inputGroup">
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required>
      </div>
      <button type="submit">Login</button>
    </form>
    <p id="info">please log in</p>
  </div>
  </main>
  <%- include('../../assets/footer.html') %>
</body>
